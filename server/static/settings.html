<p class="fs-5">Here you can configure the settings of the application.</p>

<form class="form-settings">

  <div class="row">
    <div class="col">
      Google Gemini API key
      <a href="https://aistudio.google.com/app/apikey" class="ms-1" target="_blank" title="Obtain an API key"><svg class="bi mb-1" width="16" height="16"><use xlink:href="#info"/></svg></a>
    </div>
    <div class="col">
      <input name="googleApiKey" id="googleApiKey" type="text" class="form-control" placeholder="Enter the API key" aria-label="Google Gemini API key">
    </div>
  </div>

  <div class="row">
    <div class="col">
      OpenAI API key
      <a href="https://platform.openai.com/api-keys" class="ms-1" target="_blank" title="Obtain an API key"><svg class="bi mb-1" width="16" height="16"><use xlink:href="#info"/></svg></a>
    </div>
    <div class="col">
      <input type="text" name="openaiApiKey" id="openaiApiKey" class="form-control" placeholder="Enter the API key" aria-label="OpenAI API key">
    </div>
  </div>

  <div class="row">
    <div class="col">
      Anthropic Claude API key
      <a href="https://console.anthropic.com/settings/keys" class="ms-1" target="_blank" title="Obtain an API key"><svg class="bi mb-1" width="16" height="16"><use xlink:href="#info"/></svg></a>
    </div>
    <div class="col">
      <input type="text" name="claudeApiKey" id="claudeApiKey" class="form-control" placeholder="Enter the API key" aria-label="Anthropic Claude API key">
    </div>
  </div>

  <div class="mt-3">
    <button class="btn btn-primary" type="submit">Save settings</button>
    <span id="settingsResult" class="ms-3"></span>
  </div>

</form>

<script>
  const form = document.querySelector('form');
  const googleApiKey = document.getElementById('googleApiKey');
  const openaiApiKey = document.getElementById('openaiApiKey');
  const claudeApiKey = document.getElementById('claudeApiKey');
  const settingsResult = document.getElementById('settingsResult');

  document.addEventListener("DOMContentLoaded", () => {
    loadSettings();
  })

  form.addEventListener("submit", async (event) => {
    event.preventDefault();
    settingsResult.innerHTML = "";
    form.setAttribute('disabled', '');

    try {
      const response = await fetch('/save_config', {
        method: 'POST',
        body: new URLSearchParams(new FormData(form))
      });

      const body = await response.text();
      settingsResult.innerHTML = body;

      loadSettings();
    } catch (error) {
      console.log("Error: " + error);
    }

    form.removeAttribute('disabled');
  });

  async function loadSettings() {
    try {
      const response = await fetch("/config");
      if (!response.ok) {
        throw new Error(`Response status: ${response.status}`);
      }

      const json = await response.json();

      googleApiKey.value = json.googleApiKey;
      openaiApiKey.value = json.openaiApiKey;
      claudeApiKey.value = json.claudeApiKey;
    } catch (error) {
      console.error(error.message);
    }
  }
</script>